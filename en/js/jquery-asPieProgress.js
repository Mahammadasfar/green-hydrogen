!function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)}(function(t){"use strict";function i(){return void 0!==window.performance&&window.performance.now?window.performance.now():Date.now()}Date.now||(Date.now=function(){return(new Date).getTime()});for(var e=["webkit","moz"],n=0;n<e.length&&!window.requestAnimationFrame;++n){var s=e[n];window.requestAnimationFrame=window[s+"RequestAnimationFrame"],window.cancelAnimationFrame=window[s+"CancelAnimationFrame"]||window[s+"CancelRequestAnimationFrame"]}if(/iP(ad|hone|od).*OS (6|7)/.test(window.navigator.userAgent)||!window.requestAnimationFrame||!window.cancelAnimationFrame){var a=0;window.requestAnimationFrame=function(t){var e=i(),n=Math.max(a+16,e);return setTimeout(function(){t(a=n)},n-e)},window.cancelAnimationFrame=clearTimeout}var r=function(i,e){var n=document.createElementNS("http://www.w3.org/2000/svg",i);return t.each(e,function(t,i){n.setAttribute(t,i)}),n},o="createElementNS"in document&&new r("svg",{}).createSVGRect;var h="asPieProgress",c=t[h]=function(i,e){this.element=i,this.$element=t(i),this.options=t.extend({},c.defaults,e,this.$element.data()),this.namespace=this.options.namespace,this.classes=this.options.classes,this.easing=c.easing[this.options.easing]||c.easing.ease,this.$element.addClass(this.classes.element),this.min=this.$element.attr("aria-valuemin"),this.max=this.$element.attr("aria-valuemax"),this.min=this.min?parseInt(this.min,10):this.options.min,this.max=this.max?parseInt(this.max,10):this.options.max,this.first=this.$element.attr("aria-valuenow"),this.first=this.first?parseInt(this.first,10):this.options.first?this.options.first:this.min,this.now=this.first,this.goal=this.options.goal,this._frameId=null,this.initialized=!1,this._trigger("init"),this.init()};c.defaults={namespace:"asPieProgress",classes:{svg:"pie_progress__svg",element:"pie_progress",number:"pie_progress__number",content:"pie_progress__content"},min:0,max:100,goal:100,size:100,speed:70,barcolor:"#CD222D",barsize:"6",trackcolor:"#B4B4B4",fillcolor:"none",easing:"ease",numberCallback:function(t){return Math.round(this.getPercentage(t))+"%"},contentCallback:null};var l=function(t,i,e,n){function s(t,i){return 1-3*i+3*t}function a(t,i){return 3*i-6*t}function r(t){return 3*t}function o(t,i,e){return((s(i,e)*t+a(i,e))*t+r(i))*t}return t===i&&e===n?{css:"linear",fn:function(t){return t}}:{css:"cubic-bezier("+t+","+i+","+e+","+n+")",fn:function(h){return o(function(i){for(var n,h,c,l=i,u=0;u<4;++u){var m=(n=l,3*s(h=t,c=e)*n*n+2*a(h,c)*n+r(h));if(0===m)return l;l-=(o(l,t,e)-i)/m}return l}(h),i,n)}}};t.extend(c.easing={},{ease:l(.25,.1,.25,1),linear:l(0,0,1,1),"ease-in":l(.42,0,1,1),"ease-out":l(0,0,.58,1),"ease-in-out":l(.42,0,.58,1)}),c.prototype={constructor:c,init:function(){this.$number=this.$element.find("."+this.classes.number),this.$content=this.$element.find("."+this.classes.content),this.size=this.options.size,this.width=this.size,this.height=this.size,this.prepare(),this.initialized=!0,this._trigger("ready")},prepare:function(){o&&(this.svg=new r("svg",{version:"1.1",preserveAspectRatio:"xMinYMin meet",viewBox:"0 0 "+this.width+" "+this.height}),this.buildTrack(),this.buildBar(),t('<div class="'+this.classes.svg+'"></div>').append(this.svg).appendTo(this.$element))},buildTrack:function(){var t=this.size/2,i=this.size/2,e=this.options.barsize,n=new r("ellipse",{rx:t-e/2,ry:i-e/2,cx:t,cy:i,stroke:this.options.trackcolor,fill:this.options.fillcolor,"stroke-width":e});this.svg.appendChild(n)},buildBar:function(){if(o){var t=new r("path",{fill:"none","stroke-width":this.options.barsize,stroke:this.options.barcolor});this.bar=t,this.svg.appendChild(t),this._drawBar(this.first),this._updateBar()}},_drawBar:function(t){if(o){this.bar_goal=t;var i=this.size/2,e=this.size/2,n=this.options.barsize,s=Math.min(i,e)-n/2;this.r=s;var a=this.getPercentage(t);100===a&&(a-=1e-4);var r=0+a*Math.PI*2/100,h=i+s*Math.sin(0),c=e-s*Math.cos(0),l=i+s*Math.sin(r),u=e-s*Math.cos(r),m=0;r-0>Math.PI&&(m=1);var f="M"+h+","+c+" A"+s+","+s+" 0 "+m+" 1 "+l+","+u;this.bar.setAttribute("d",f)}},_updateBar:function(){if(o){var t=this.getPercentage(this.now),i=this.bar.getTotalLength(),e=i*(1-t/this.getPercentage(this.bar_goal));this.bar.style.strokeDasharray=i+" "+i,this.bar.style.strokeDashoffset=e}},_trigger:function(t){var i=Array.prototype.slice.call(arguments,1),e=[this].concat(i);this.$element.trigger(h+"::"+t,e);var n="on"+(t=t.replace(/\b\w+\b/g,function(t){return t.substring(0,1).toUpperCase()+t.substring(1)}));"function"==typeof this.options[n]&&this.options[n].apply(this,i)},getPercentage:function(t){return 100*(t-this.min)/(this.max-this.min)},go:function(t){var e,n=this;this._clear(),"string"==typeof(e=t)&&-1!=e.indexOf("%")&&(t=parseInt(t.replace("%",""),10),t=Math.round(this.min+t/100*(this.max-this.min))),void 0===t&&(t=this.goal),t>this.max?t=this.max:t<this.min&&(t=this.min),this.bar_goal<t&&this._drawBar(t);var s=n.now,a=i(),r=a+100*Math.abs(s-t)*n.options.speed/(n.max-n.min),o=function(i){var e;if(i>r)e=t;else{var h=(i-a)/n.options.speed;e=Math.round(n.easing.fn(h/100)*(n.max-n.min)),t>s?(e=s+e)>t&&(e=t):(e=s-e)<t&&(e=t)}n._update(e),e===t?(window.cancelAnimationFrame(n._frameId),n._frameId=null,n.now===n.goal&&n._trigger("finish")):n._frameId=window.requestAnimationFrame(o)};n._frameId=window.requestAnimationFrame(o)},_update:function(t){this.now=t,this._updateBar(),this.$element.attr("aria-valuenow",this.now),this.$number.length>0&&"function"==typeof this.options.numberCallback&&this.$number.html(this.options.numberCallback.call(this,[this.now])),this.$content.length>0&&"function"==typeof this.options.contentCallback&&this.$content.html(this.options.contentCallback.call(this,[this.now])),this._trigger("update",t)},_clear:function(){this._frameId&&(window.cancelAnimationFrame(this._frameId),this._frameId=null)},get:function(){return this.now},start:function(){this._clear(),this._trigger("start"),this.go(this.goal)},reset:function(){this._clear(),this._drawBar(this.first),this._update(this.first),this._trigger("reset")},stop:function(){this._clear(),this._trigger("stop")},finish:function(){this._clear(),this._update(this.goal),this._trigger("finish")},destory:function(){this.$element.data(h,null),this._trigger("destory")}},t.fn[h]=function(i){if("string"!=typeof i)return this.each(function(){t.data(this,h)||t.data(this,h,new c(this,i))});var e=i,n=Array.prototype.slice.call(arguments,1);if(/^\_/.test(e))return!1;if(!/^(get)$/.test(e))return this.each(function(){var i=t.data(this,h);i&&"function"==typeof i[e]&&i[e].apply(i,n)});var s=this.first().data(h);return s&&"function"==typeof s[e]?s[e].apply(s,n):void 0}});